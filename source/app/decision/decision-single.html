<div class="app-top-panel">
    <div class="app-container-sm">
        <div class="row">
            <div class="col-sm-12">
                <div class="pull-right">
                    <a href class="btn btn-primary-2 btn-sm">Ask for Decision</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="app-container-sm">

    <div class="row">
        <div ng-class="vm.decisionParents.length ? 'col-sm-9' : 'col-sm-12'">
            <h3 class="app-title-inline" ng-bind="::vm.decision.name"></h3>
            <div class="post-header">
                <div class="nav-tabs-wrapper" ng-show="vm.criteriaGroups.length || vm.isDecisionsParent || vm.decisionParents.length">
                    <ul class="nav nav-tabs nav-tabs-sm">
                        <li class="active">
                            <a ui-sref="decisions.single(::{id:vm.decision.id, slug:vm.decision.nameSlug, size: null, page: null, tab: null})">General Info</a>
                        </li>
                        <li ng-if="vm.decisionParents.length">
                            <a ui-sref="decisions.single.options">Options</a>
                        </li>                        
                        <li ng-repeat="parent in vm.decisionParents track by $index" ng-class="{'active':vm.activeTab == $index + 1}">
                            <a ui-sref="decisions.single.parent(::{parentId:parent.id, parentSlug:parent.nameSlug, tab: null})"> {{::parent.name}}</a>
                        </li>
                        <li>
                            <a ui-sref="decisions.single.nominations({tab: null})">Nominations</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="post-sub-header">
                <div class="row">
                    <div class="col-sm-8">
                        <div class="info">
                            <div class="author info-divider">
                                <i class="fa fa-user-o" aria-hidden="true"></i>
                                <span ng-bind="::vm.decision.createUser.username"></span>
                            </div>
                            <div class="date info-divider">
                                <i class="fa fa-calendar-o" aria-hidden="true"></i>
                                <span ng-bind="::vm.decision.createDate | date:'MM/dd/yyyy'"></span>
                            </div>
                            <div class="info-divider">
                                <i class="fa fa-eye" aria-hidden="true"></i>
                                <span ng-bind="::vm.decision.totalViews"></span>
                            </div>

                            <div class="info-divider">
                                <a href="#" class="link-secondary">
                                    <i class="fa fa-flag" aria-hidden="true"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                    </div>
                </div>
            </div>

            <div class="post post-single with-rating">

                <!-- TODO: move to componetns -->
                <div class="app-votes">
                    <a href="#" class="up">
                        <span class="app-vote-control app-sorter-top glyphicon glyphicon-triangle-top"></span>
                    </a>
                    <div class="total" ng-bind="::(vm.decision.totalLikes || 0)">
                    </div>
                    <a href="#" class="down">
                        <span class="app-vote-control app-sorter-bottom glyphicon glyphicon-triangle-bottom"></span>
                    </a>

                    <div class="app-votes-decision-rating">
                        <i class="icon fa fa-star" aria-hidden="true"></i>
                        <div class="total">
                            0
                        </div>
                    </div>
                </div>

                <div class="clearfix text-justify">
                    <div class="post-image">
                        <img ng-if="::vm.decision.imageUrl" ng-src="{{::vm.decision.imageUrl}}" class="img-responsive" src-error>
                        <div ng-if="::!vm.decision.imageUrl">
                            <img ng-src="/images/noimage.jpg" alt="" class="img-responsive mg-b-sm" >
                            <a href="#" class="btn btn-sm btn-default">Change</a>
                        </div>
                    </div>
                    <div ng-bind-html="::(vm.decision.description || '<div class=\'app-action-text\'>There are no description provided yet, but you can be first to create them here.</div>')"></div>
                </div>
            </div>
            <div class="row decision-childs">
                <div class="col-xs-12 mg-sm-b">
                    <div class="nav-tabs-wrapper clearfix tabs-right" ng-show="vm.isDecisionsParent">
                        <h4 class="tabs-title">
                            All Options
                            <span class="title-counter">({{::vm.totalCount}})</span>
                        </h4>
                        <span class="text-header">
                            Can't find the necessary option? <a href="#">Add it</a>
                        </span>
                        <ul class="nav nav-tabs nav-tabs-sm">
                            <li ui-sref-active="active" ng-repeat="item in ::vm.navigation track by $index" ng-class="{'active':vm.activeTabSort == $index + 1}">
                                <a ui-sref="decisions.single(::{tab:item.key})">{{item.label}}</a>
                            </li>
                        </ul>
                    </div>

                    <div ng-if="!vm.isDecisionsParent">
                        <div class="nav-tabs-wrapper mg-b-sm clearfix tabs-right">
                            <h4 class="tabs-title">
                                All Options
                            </h4>
                            <span class="text-header">
                                Can't find the necessary option? <a href="#">Add it</a>
                            </span>
                            <ul class="nav nav-tabs nav-tabs-sm">
                                <li ng-repeat="item in ::vm.navigation track by $index" ng-class="{'active':vm.activeTabSortChild == $index}">
                                    <a ng-click="vm.activeTabSortChild = $index">{{item.label}}</a>
                                </li>
                            </ul>
                        </div>

                        <!-- Tabs content -->
                        <div class="row">
                            <div class="col-sm-7">
                                <div class="mg-b-lg app-action-text">
                                    There are no options yet, but you can be first to create them here.
                                </div>
                            </div>
                            <div class="col-sm-5 px-l-0" ng-show="vm.activeTabSortChild == 0">
                                <criteria-list list="::vm.criteriaGroups"></criteria-list>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-sm-12" ng-if="vm.isDecisionsParent">


                    <div class="row">
                        <div class="col-md-8">
                            <!-- TODO: make as component -->
                            <!-- Filter  -->
                            <div class="filter-name">
                                <input type="text" class="form-control input-sm" placeholder="Filter by name" ng-model="vm.filterName" ng-model-options="vm.controlOptions" ng-keyup="vm.filterNameSubmit($event, vm.filterName)">
                                <i class="filter-btn fa fa-search" aria-hidden="true" ng-click="vm.filterNameSubmitClick(vm.filterName)"></i>
                                <i class="fa fa-times icon-remove" aria-hidden="true" ng-click="vm.clearFilterName()" ng-show="vm.filterName.length > 0"></i>
                            </div>
                            <!-- Filter Name -->
                        </div>


                        <div class="col-md-4">

                            <a ui-sref="decisions.single.comparison({analysisId:null})" class="btn btn-primary-2 btn-comparison pull-right">
                                Comparison Matrix
                            </a>

                        </div>
                    </div>
                    

                    <!-- TODO: Use componnet -->
                    <div class="decisions-list list-with-sm-icons" ng-style="{'min-height': vm.decisionsHeight}"  ng-if="vm.isDecisionsParent">

                        <div class="post" ng-repeat="decision in vm.decisions track by decision.id">
                            <div class="post-inner">
                                <a class="img-link" ui-sref="decisions.single.parent({id:decision.id, slug: decision.nameSlug, parentId:vm.decision.id, parentSlug:vm.decision.nameSlug, tab: null})" class="left-side">
                                    <div class="img-container">
                                        <img ng-src="{{::decision.imageUrl}}" class="img-responsive" src-error>
                                    </div>
                                </a>

                                <div class="post-content">

                                    <div class="criteria-block" ng-show="decision.criteriaCompliancePercentage">
                                        <div class="counters">
                                            <span ng-bind="::decision.criteriaCompliancePercentage"></span>%
                                            <span class="app-icon glyphicon glyphicon-thumbs-up"></span> {{::decision.totalVotes}}
                                        </div>
                                        <div class="text-uppercase">
                                            criteria score
                                        </div>
                                    </div>

                                    <div class="post-header-content">
                                        <a class="post-title" ui-sref="decisions.single.parent({id:decision.id, slug: decision.nameSlug, parentId:vm.decision.id, parentSlug:vm.decision.nameSlug, tab: null})" ng-bind="::decision.name"></a>

                                        <div class="info">
                                            <div class="author info-divider">
                                                <i class="fa fa-user-o" aria-hidden="true"></i>
                                                <span ng-bind="decision.createUser.username"></span>
                                            </div>
                                            <div class="date info-divider">
                                                <i class="fa fa-calendar-o" aria-hidden="true"></i>
                                                <span ng-bind="decision.createDate | date:'MM/dd/yyyy'"></span>
                                            </div>
                                            <div class="info-divider">
                                                <i class="fa fa-eye" aria-hidden="true"></i>
                                                <span ng-bind="decision.totalViews"></span>
                                            </div>
                                            <div class="info-divider">
                                                <a href="#" class="link-secondary">
                                                    <i class="fa fa-flag" aria-hidden="true"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="post-description" ng-show="::decision.description" ng-bind-html="::decision.description"></div>

                                </div>
                            </div>
                        </div>

                    </div>

                    <div ng-show="vm.decisionsSpinnerChilds" class="app-loader-small"><span class="glyphicon glyphicon-refresh app-loader-animation"></span>LOADING...</div>
                </div>
                <!-- Criteria -->
 <!--                <div class="col-sm-5 px-l-0" ng-if="vm.tabMode === 'topRated'">
                    <criteria-list ng-if="vm.criteriaGroups" list="vm.criteriaGroups"></criteria-list>
                </div> -->
                <!-- End Criteria -->
                <div class="col-sm-12 text-center look-more" ng-if="vm.isDecisionsParent">
                    Looking for more? Browse the 
                    <a ui-sref="decisions.single.options"  class="text-bold">
                        the complete list of decisions
                    </a>
                </div>
            </div>
        </div>

        <!-- Recommended Start -->
        <div class="col-sm-3 recommended-list" ng-if="vm.decisionParents.length">
            <h4>
                 Recommended
            </h4>

            <div class="nav-tabs-wrapper tabs-left">
                <ul class="nav nav-tabs nav-tabs-sm">
                    <li  ng-repeat="parent in vm.decisionParents track by $index" ng-class="{'active':vm.activeRecommendedTab.id === parent.id}">
                        <a ng-click="vm.getRecommendedDecisions(vm.decision.id, parent)"> {{::parent.name}}</a>
                    </li>
                </ul>
                <div class="pull-right text-header">
                    <a ui-sref="decisions.single({id:vm.activeRecommendedTab.id, slug:vm.activeRecommendedTab.nameSlug, size: null, page: null, tab: null})" class="see-all">
                        See All <span class="info">({{vm.activeRecommendedTab.total || 0}})</span>
                    </a>
                </div>
            </div>

            <decisions-list class-name="'cards'" compare="true" list="vm.recommendedDecisionsList" criteria-compliance="true"></decisions-list>

            <div ng-show="vm.recommendedDecisionsListLoader" class="app-loader-small"><span class="glyphicon glyphicon-refresh app-loader-animation"></span>LOADING...</div>

        </div>
        <!-- End Recommended Start -->
    </div>

    <div class="row">
        <div class="col-sm-8">
            <div class="comments">
                <h3 class="comments-tile">Comments</h3>
                <comments decision-id="::vm.discussion.decision.totalChildDecisions" option-id="vm.discussion.childCriteria.criteriaId"></comments>
            </div>
        </div>
    </div>

</div>
