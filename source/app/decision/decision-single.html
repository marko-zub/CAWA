<div class="app-container-sm">

    <div class="row">
        <div class="col-sm-9">
        <!-- <div ng-class="vm.decisionParents.length ? 'col-sm-9' : 'col-sm-12'"> -->
            <h3 class="app-title-inline" ng-bind="::vm.decision.name"></h3>
            <div class="post-header">

                <app-votes></app-votes>

                <div class="nav-tabs-wrapper">
                    <ul class="nav nav-tabs nav-tabs-sm">
                        <li class="active">
                            <a ui-sref="decisions.single(::{id:vm.decision.id, slug:vm.decision.nameSlug, size: null, page: null, tab: null})" translate-cloak>{{ 'General Info' | translate }}</a>
                        </li>
                        <li ng-repeat="parent in vm.parentDecisionGroupsTabs track by $index" ng-class="{'active':vm.activeTab == $index + 1}">
                            <a ui-sref="decisions.single.parent(::{parentId:parent.id, parentSlug:parent.nameSlug, tab: null})" translate-cloak>{{ ::parent.ownerDecision.name }}/{{ ::parent.name }}</a>
                        </li>
                        <li>
                            <a ui-sref="decisions.single.reviews" translate-cloak>{{ 'Reviews' | translate }}</a>
                        </li>
                        <li>
                            <a ui-sref="decisions.single.options" translate-cloak>{{ 'Options' | translate }}</a>
                        </li>
                        <li>
                            <a ui-sref="decisions.single.nominations({tab: null})" translate-cloak>{{ 'Nominations' | translate }}</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="post-sub-header">
                <div class="row">
                    <div class="col-sm-8">
                        <decision-short-info decision="::vm.decision"></decision-short-info>
                    </div>
                    <div class="col-sm-4">
                        <div class="pull-right">
                            <compare-button decision="vm.decision" parent-decision="vm.decisionParents[0]"></compare-button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="post post-single with-rating">

                <div class="clearfix text-justify">
                    <div class="post-image">
                        <img ng-src="{{::vm.decision.imageUrl}}" class="img-responsive">
                    </div>
                    <div class="page-description" ng-bind-html="(vm.decision.description || 'NO DESCRIPTION' | translate)" translate-cloak></div>
                </div>


                <media-links list="vm.decision.medias"></media-links>

                <!-- Gallery -->
                <media list="vm.decision.medias"></media>
                <!-- End Gallery -->

            </div>


            <div class="row decision-childs">

                <div class="col-xs-12 mg-sm-b">
                    <div class="nav-tabs-wrapper clearfix tabs-right">
                        <h4 class="tabs-title" translate-cloak>
                            {{ 'All Options' | translate }}
                            <span ng-if="vm.isDecisionsParent && !vm.decisionsChildsLoader" class="title-counter" translate-cloak>({{::vm.totalCount}})</span>
                        </h4>
                        <span class="text-header" translate-cloak>
                            {{ "Can't find the necessary option?" | translate }} <a href="#">{{ 'Add it' | translate }}</a>
                        </span>
                        <ul class="nav nav-tabs nav-tabs-sm" ng-if="vm.decisionGroups && !vm.decisionsChildsLoader">
                            <li ng-repeat="item in vm.decisionGroups track by $index" ng-class="{'active':vm.activeDecisionGroupsTabIndex === $index }">
                                <a ui-sref="decisions.single.options.child(::{optionChildId: item.id, optionChildSlug: item.nameSlug})" ui-sref-opts="{notify: false}" ng-click="vm.changeOptionTab(item.key)">{{ item.name | translate }}</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Tabs content -->
                <div ng-if="!vm.childDecisionGroups.length && !vm.decisionsChildsLoader">
                    <div class="col-sm-7">
                        <div class="mg-b-md app-action-text" translate-cloak>
                            {{ "NO OPTIONS" | translate }} <a href="#">{{ "HERE" | translate }}</a>.
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-xs-12 mg-sm-b">

                        <decisions-list compare="true" list="vm.childDecisionGroups" parent-decision="vm.decision"></decisions-list>

           <!--              <ul class="nav nav-tabs nav-tabs-sm" ng-if="vm.isDecisionsParent && !vm.decisionsChildsLoader">
                            <li ng-repeat="item in ::vm.navigation track by $index" ng-class="{'active':vm.activeTabSort === $index }">
                                <a ui-sref="decisions.single(::{tab:item.key})" ui-sref-opts="{notify: false}" ng-click="vm.changeOptionTab(item.key)">{{ item.label | translate }}</a>
                            </li>
                        </ul> -->
                    </div>
                </div>
        

                <div class="col-sm-12">

                    <div ng-show="vm.isDecisionsParent">
                        <div class="row">
                            <div class="col-md-8">
                                <!-- TODO: make as component -->
                                <!-- Filter  -->
                                <div class="filter-name">
                                    <input type="text" class="form-control input-sm" placeholder="{{ 'Filter by name' | translate }}" ng-model="vm.filterName" ng-model-options="vm.controlOptions" ng-keyup="vm.filterNameSubmit($event, vm.filterName)">
                                    <i class="filter-btn fa fa-search" aria-hidden="true" ng-click="vm.filterNameSubmitClick(vm.filterName)"></i>
                                    <i class="fa fa-times icon-remove" aria-hidden="true" ng-click="vm.clearFilterName()" ng-show="vm.filterName.length > 0"></i>
                                </div>
                                <!-- Filter Name -->
                            </div>
                            <div class="col-md-4">

                                <a ui-sref="decisions.single.comparison({analysisId:null})" class="btn btn-primary-2 btn-comparison pull-right" translate-cloak>
                                    {{ 'Comparison Matrix' | translate }}
                                </a>

                            </div>
                        </div>

                        <div class="decisions-list" ng-style="{'min-height': vm.decisionsHeight}" ng-if="!vm.decisionsChildsLoader">
                            <decisions-list compare="true" list="vm.decisions" criteria-groups-list="vm.criteriaGroups" criteria-list="true" parent-decision="vm.decision"></decisions-list>

                            <!-- TODO: remove second loader -->
                            <div ng-show="vm.decisionsChildsLoaderRequest" class="app-loader-small"><span></span></div>
                        </div>


                        <div ng-show="vm.isDecisionsParent && vm.decisionsChildsLoader" class="app-loader-small"><span></span></div>
                    </div>

                </div>
                <div class="col-sm-12 text-center look-more" ng-if="!vm.decisionsChildsLoader && vm.childDecisionGroups.length">
                    {{ "LOOKING MORE" | translate }}
                    <a ui-sref="decisions.single.options" class="text-bold" translate-cloak>
                        {{ "the complete list of decisions" | translate }}
                    </a>
                </div>
            </div>


            <div class="row" ng-show="!vm.decisionsChildsLoader">
                <div class="col-sm-8">
                    <div class="comments">
                        <h4 class="comments-tile" translate-cloak>{{ 'Comments' | translate }}</h4>
                        <comments decision-id="::vm.discussion.decision.totalChildDecisions" option-id="vm.discussion.childCriteria.criteriaId"></comments>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-sm-3">

            <!-- Properties List -->
            <div class="properties-list-wrapper">
                <properties-list list="::vm.properties" ng-if="vm.properties.length"></properties-list>
                <div ng-show="vm.propertiesDecisionsListLoader" class="app-loader-small"><span></span></div>
            </div>
            <!-- End Properties List -->

            <!-- Owners -->
            <owner-users list="vm.decision.ownerUsers" become-title="vm.decision.name"></owner-users>
            <!-- End Owners -->

            <!-- Recommended Start -->
            <!-- TODO: move to component -->
            <div class="recommended-list" translate-cloak>
                <h4>{{ "Recommended" | translate }}</h4>

                <div class="nav-tabs-wrapper tabs-left">
                    <ul class="nav nav-tabs nav-tabs-sm">
                        <li ng-repeat="parent in vm.decisionParents track by $index" ng-class="{'active':vm.activeRecommendedTab.id === parent.id}">
                            <a ng-click="vm.getRecommendedDecisions(vm.decision.id, parent)"> {{::parent.name}}</a>
                        </li>
                    </ul>
                    <div class="pull-right text-header">
                        <a ui-sref="decisions.single.options({id:vm.activeRecommendedTab.id, slug:vm.activeRecommendedTab.nameSlug, size: null, page: null, tab: null})" class="see-all" translate-cloak>
                            {{ 'See All' | translate }} <span class="info">({{vm.activeRecommendedTab.total || 0}})</span>
                        </a>
                    </div>
                </div>

                <decisions-list class-name="'cards'" compare="true" list="vm.recommendedDecisionsList" criteria-groups-list="vm.criteriaGroups" criteria-list="true" parent-decision="vm.activeRecommendedTab"></decisions-list>

                <div ng-show="vm.recommendedDecisionsListLoader" class="app-loader-small"><span></span></div>

            </div>
            <!-- End Recommended Start -->
        </div>
    </div>

</div>
