<div class="decision matrix matrix-new">
    <div class="matrix-wrapper">

        <div class="tabs-wrapper">
            <div class="nav-tabs-wrapper matrix-mode-tabs clearfix">
                <ul class="nav nav-tabs nav-tabs-sm">
                    <li ng-class="{'active':vm.matrixMode == 'inclusion'}">
                        <a ng-click="vm.changeMatrixMode('inclusion')">
                            <span ng-bind="::vm.decision.name"></span>
                            <span ng-show="vm.inclusionItemsLength >= 0">
                                (<span ng-bind="vm.inclusionItemsLength"></span>)
                            </span>
                        </a>
                    </li>
                    <li ng-class="{'active':vm.matrixMode == 'exclusion'}">
                        <a ng-click="vm.changeMatrixMode('exclusion')">
                            {{ 'SELECTED' | translate }}
                            <span ng-show="vm.exclusionItemsLength >= 0">
                            (<span ng-bind="vm.exclusionItemsLength"></span>)
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div id="matrix-table" class="main-panel matrix-table js-matrix-table">
            <div id="panel" class="app-panel matrix-panel">
                <div ng-show="vm.decisionsLoader" class="app-loader-small"><span></span></div>
                <!-- Header -->
                <div class="matrix-header">
                    <div class="matrix-row">

                        <div class="matrix-g-name">
                            <div class="matrix-title-wrapper">
                                <div class="matrix-title app-sorter-wrapper m-content-name" translate-cloak>
                                    <select class="form-control input-sm" ng-model="vm.fo.sortByDecisionProperty.id" ng-options="item.id as item.name | translate for item in vm.sortDecisionPropertyOptions" ng-change="vm.orderByDecisionProperty(vm.fo.sortByDecisionProperty, $event)">
                                        <option value="">{{ 'SORT BY PROPERTY' | translate }} </option>
                                    </select>
                                </div>

                                <!-- Filter  -->
                                <div class="filter-wrapper">
                                    <div class="filter-name">
                                        <input type="text" class="form-control input-sm" placeholder="{{ 'Filter by name' | translate }}" ng-model="vm.filterName" ng-model-options="vm.controlOptions" ng-keyup="vm.filterNameSubmit($event, vm.filterName)">
                                        <i class="filter-btn fa fa-search" aria-hidden="true" ng-click="vm.filterNameSubmitClick(vm.filterName)"></i>
                                        <i class="fa fa-times icon-remove" aria-hidden="true" ng-click="vm.clearFilterName()" ng-show="vm.filterName.length > 0"></i>
                                    </div>
                                </div>
                                <!-- Filter Name -->

                                <div class="app-sorter active" ng-class="vm.fo.sortByDecisionProperty.order.toLowerCase()" ng-click="vm.orderByDecisionProperty(vm.fo.sortByDecisionProperty)">
                                    <span class="app-sorter-top glyphicon glyphicon-triangle-top"></span>
                                    <span class="app-sorter-bottom glyphicon glyphicon-triangle-bottom"></span>
                                </div>

                            </div>
                        </div>

                        <!-- End Make Sticky -->

                        <!-- TODO: move to component matrix header -->
                        <!-- Decisions Header -->
                        <div id="matrix-scroll-group" class="scroll-group">
                            <div class="matrix-col matrix-col-name matrix-g" ng-repeat="item in vm.decisionMatrixList track by item.decision.id">
                                <div class="m-col-content m-content-name decision-matrix-col">
                                    <a class="matrix-col-link" ui-sref="decisions.single(::{id:item.decision.id, slug: item.decision.nameSlug})">
                                        <!-- deep watch {discussionId:item.decision.id, discussionSlug:item.decision.nameSlug} -->
                                        <div class="app-title-inline">
                                            <span ng-bind="::item.decision.name"></span>
                                        </div>
                                        <div class="clearfix">
                                            <div class="decision-img-block img-link">
                                                <div class="matrix-img-container img-sm img-wrapper">
                                                    <img ng-src="{{::item.decision.imageUrl}}" class="img-responsive" '>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                    <div class="decision-content-block">
                                        <div dw-popover dw-popover-id="criteria-{{::item.decision.id}}" decision="item.decision" parent-decision="vm.decision" dw-popover-direction="bottom">
                                            <a
                                                class="decision-criteria-compilance popover-ref"
                                                ng-show="item.decision.criteriaCompliancePercentage >= 0"
                                                ui-sref="decisions.single.characteristics(::{id:item.decision.id, slug: item.decision.nameSlug, parentId:vm.decision.id, parentSlug:vm.decision.nameSlug})">
                                                <div class="text-uppercase" translate-cloak>
                                                    {{ 'CRITERIA SCORE' | translate }}
                                                </div>
                                                <div class="counters">
                                                    <span ng-bind="item.decision.criteriaCompliancePercentage"></span>%
                                                    <span class="icon-svg-vote"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M501.333 0c-25.11 0-57.024 16.128-66.475 21.205L298.668.363c-19.137 0-65.324 1.237-80.3 12.267L133.035 65.6c-4.053 2.517-5.93 7.403-4.63 11.99 1.324 4.586 5.505 7.743 10.262 7.743h96c.853 0 1.685-.107 2.517-.256l14.293-3.52c9.237-1.344 18.453 1.408 25.472 7.488 7.04 6.08 11.05 14.89 11.05 24.192 0 7.403-2.304 14.464-6.677 20.46l-33.557 46.1c-9.365 14.037-7.51 32.896 4.437 44.843 6.933 6.912 16.02 10.39 25.13 10.39s18.198-3.478 25.132-10.412l54.08-54.08c20.203-1.13 38.677-9.856 52.373-23.936 18.944 17.557 79.573 23.125 91.584 24.043.277.02.555.02.832.02 2.667 0 5.27-1.002 7.232-2.836C510.763 165.8 512 162.964 512 160V10.667C512 4.78 507.22 0 501.334 0zm-85.29 71.296l-12.31 46.7c-10.11 19.348-29.844 31.338-51.732 31.338-2.836 0-5.546 1.11-7.55 3.115l-57.09 57.087c-5.354 5.355-14.72 5.355-20.074 0-4.78-4.757-5.525-12.31-2.027-17.557l33.322-45.74c7.04-9.663 10.752-21.098 10.752-33.044 0-15.467-6.7-30.165-18.39-40.3-9.663-8.362-21.887-12.927-35.028-12.927-2.773 0-5.61.212-8.448.618L233.408 64h-57.344l54.25-33.707c6.678-4.907 36.054-8.597 66.732-8.725l126.528 19.477c-2.07 7.403-4.758 17.856-7.53 30.25zm74.624 76.97c-23.06-2.602-51.392-7.914-63.467-14.634 2.133-20.736 5.888-40.832 9.6-57.43l9.77-37.076c9.857-5.184 28.225-13.61 44.097-16.66v125.8z"/><path d="M405.163 392.917l-21.333-128c-.853-5.14-5.29-8.917-10.517-8.917H320c0-5.888-4.78-10.667-10.667-10.667s-10.667 4.78-10.667 10.667v10.56c0 .043-.02.064-.02.107s.02.064.02.107V320h-192V128H256c5.888 0 10.667-4.78 10.667-10.667s-4.78-10.667-10.667-10.667H96c-5.888 0-10.667 4.78-10.667 10.667V256H32c-5.205 0-9.664 3.776-10.517 8.917l-21.333 128c-.043.277.064.533.043.79-.022.34-.193.618-.193.96v106.667C0 507.22 4.78 512 10.667 512h384c5.888 0 10.667-4.78 10.667-10.667V394.667c0-.363-.17-.683-.213-1.024-.02-.256.085-.49.043-.726zM41.023 277.333h44.31V320H74.667C68.78 320 64 324.78 64 330.667s4.78 10.667 10.667 10.667h256c5.888 0 10.667-4.78 10.667-10.667S336.554 320 330.667 320H320v-42.667h44.288L382.058 384H23.254l17.77-106.667zM384 490.667H21.333v-85.333H384v85.333z"/></svg></span><span ng-bind="item.decision.totalVotes"></span>
                                                </div>
                                            </a>
                                        </div>

                                    </div>
                                    <div class="clearfix">
                                        <div class="info">
                                            <span ng-show="::item.decision.description" class="link-secondary icon-info" popover-title="{{::item.decision.name}}" uib-popover-html="::item.decision.description" popover-placement="{{ ($last && $index === vm.pagination.pageSize) ?'bottom-right' : 'bottom'}}" popover-append-to-body="true" popover-trigger="'outsideClick'" tabindex="0"></span>
                                        </div>
                                    </div>
                                    <div class="app-panel-controls">
                                        <span ng-click="vm.updateExclusionList(item.decision.id)" class="app-control">
                                            <i class="fa" ng-class="{'fa-check' : vm.matrixMode == 'inclusion', 'fa-times': vm.matrixMode == 'exclusion'}"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Decisions Header -->
                    </div>
                </div>

                <filter-tags
                    criteria="vm.criteriaGroups"
                    characteristics="vm.characteristicGroupsArray"
                    filter-name="vm.filterName"
                    on-change-criteria-order="vm.orderByCriteriaProperty(order, $event)"
                    on-sort-by-decision-property-order="vm.orderByDecisionProperty(order, $event)"
                    filter-object="vm.fo"
                    on-show-criteria-popup="vm.editCriteriaCoefficient($event, criteria)"
                    ></filter-tags>

                <div id="matrix-body-wrapper" class="matrix-body-wrapper">
                    <!-- End Header -->
                    <!-- Table Aside -->
                    <div id="matrix-aside" class="matrix-aside">
                        <div id="matrix-aside-content" class="matrix-aside-content">

                            <!-- Criteria Aside -->
                            <div class="criteria-list group-wrapper" ng-if="vm.criteriaGroups.length">
                                <div class="group-wrapper-title">
                                    {{ 'CRITERIA' | translate }}
                                </div>
                                <div data-criteria-group="{{::group.id}}" class="matrix-g matrix-g-criteria" ng-repeat="group in vm.criteriaGroups track by group.criteriaGroupId">
                                    <div class="matrix-item matrix-g-item">
                                        <div class="matrix-g-title" ng-click="vm.toggleGroupName($event, group.id, 'criteria')">
                                            <span class="group-title-line" ng-bind="::group.name"></span>
                                            <div class="controls">
                                                <i class="fa fa-angle-up" aria-hidden="true"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="matrix-item matrix-control js-toggle-hide" ng-repeat="criteria in group.criteria track by criteria.id" ng-click="vm.selectCriteria($event, criteria)" ng-class="{'selected' : criteria.isSelected, 'hide': group.isClosed}" data-aside="m-criteria-group-{{::criteria.id}}">

                                        <div class="matrix-title-wrapper">
                                            <div class="matrix-title app-sorter-wrapper">
                                                <span ng-bind="::criteria.name"></span>
                                            <a href ng-if="::criteria.description" class="link-secondary icon-info" uib-popover-html="criteria.description" popover-placement="right" popover-append-to-body="true" popover-trigger="'outsideClick'" tabindex="0"></a>
                                            </div>
                                            <div class="btn matrix-criteria-coefficient" ng-click="vm.editCriteriaCoefficient($event, criteria)">
                                                <criteria-coefficient-indicator coefficient="criteria.coefficient"></criteria-coefficient-indicator>
                                            </div>
                                            <div class="app-sorter active" ng-click="vm.orderByCriteriaProperty(vm.fo.sortByCriteria.order, $event)" ng-class="vm.fo.sortByCriteria.order.toLowerCase()">
                                                <span class="app-sorter-top glyphicon glyphicon-triangle-top"></span>
                                                <span class="app-sorter-bottom glyphicon glyphicon-triangle-bottom"></span>
                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!-- End Criteria Aside -->

                            <div class="group-wrapper characteristic-content-aside" >

                               <div class="group-wrapper-title">

                                    {{ 'CHARACTERISTICS' | translate }}
                                </div>

                                <div ng-repeat="characteristic in vm.characteristicGroupsArray track by characteristic.uuid">
                                    <div ng-switch="::characteristic.characteristicGroupId >= 0">

                                        <!-- Title-->

                                        <div ng-switch-when="false">
                                            <div class="matrix-item matrix-g-item">
                                                <div class="matrix-g-title" ng-click="vm.toggleGroupName($event,  characteristic.id, 'characteristic')">
                                                    <span class="group-title-line" ng-bind="::characteristic.name"></span>
                                                    <div class="controls">
                                                        <i class="fa fa-angle-up" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div ng-switch-when="true" data-characteristic-group="{{::characteristic.parentId}}">
                                            <div class="matrix-item matrix-item-block js-item-aside js-toggle-hide">
                                                <!-- TODO: move to component -->

                                                    <div class="matrix-title app-sorter-wrapper" ng-bind="::characteristic.name"></div>
                                                    <filter-control item="characteristic"></filter-control>

                                                    <div class="app-sorter {{vm.fo.sortByCharacteristic.order.toLowerCase()}}" ng-if="::characteristic.isSortable" ng-click="vm.orderByCharacteristicProperty(characteristic.id, vm.fo.sortByCharacteristic.order)" ng-class="{'active': vm.fo.sortByCharacteristic.id == characteristic.id}">
                                                        <span class="app-sorter-top glyphicon glyphicon-triangle-top"></span>
                                                        <span class="app-sorter-bottom glyphicon glyphicon-triangle-bottom"></span>
                                                    </div>

                                                    <a href ng-if="::characteristic.description" class="link-secondary glyphicon glyphicon-que title-descrstion-sign" uib-popover-html="::characteristic.description" popover-placement="right" popover-append-to-body="true" popover-trigger="'outsideClick'" tabindex="0"></a>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>


                        </div>

                    </div>
                    <!-- End Table Aside -->
                    <!-- Table Body -->
                    <div id="matrix-body" class="matrix-body">
                        <!-- Table Content -->
                        <div id="matrix-content" class="matrix-content">

                            <div id="m-criteria-wrapper" class="matrix-criteria-wrapper">
                                <matrix-criteria ng-if="vm.criteriaGroups.length" decisions="vm.decisions.decisionMatrixs" criteria="vm.criteriaGroups"></matrix-criteria>
                            </div>

                            <div class="characteristic-groups-content">
                                <div ng-show="!vm.decisionsLoader && vm.characteristicGroupsContentLoader" class="app-loader-small"><span></span></div>

                                <!-- Hide to avoid reflow -->
                                <div ng-class="{'el-loaded1': vm.characteristicGroupsContentLoader}">
                                    <matrix-characteristics decisions="vm.decisions.decisionMatrixs" characteristics="vm.characteristicGroupsArray"></matrix-characteristics>
                                </div>
                            </div>

                        </div>
                        <!-- End Table Content -->
                    </div>
                    <!-- End Table Body -->
                </div>
            </div>
        </div>
        <div class="martix-footer">
            <div class="martix-footer-pagination">

                <!-- Fake scrollbar -->
                <div id="matrix-fake-scroll">
                    <div id="matrix-fake-scroll-body">

                    </div>
                </div>
                <!-- End Fake scrollbar -->

                <app-paginator total="vm.pagination.totalDecisions" page-size="vm.pagination.pageSize" page-number="vm.pagination.pageNumber" on-change-page="vm.changePage(pagination)" per-page="vm.itemsPerPage"></app-paginator>
            </div>
        </div>
    </div>
</div>

<!-- Comments -->
<pageslide class="sidebar" ps-size="500px" ps-open="vm.isCommentsOpen" ps-body-class="true" ps-click-outside="true" ps-speed="0.35" ps-body-class="true">
    <div class="sidebar-content">
        <comments decision-id="::vm.discussion.decision.totalChildDecisions" option-id="vm.discussion.childCriteria.criteriaId"></comments>
    </div>
</pageslide>
<!-- End Comments -->